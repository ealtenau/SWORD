#!/bin/bash
# Push to remote after merge; close GitHub issue if referenced in prompt
set -euo pipefail

cd "$DMUX_ROOT"

# Push merged branch to remote
git push origin "$DMUX_TARGET_BRANCH"

# Close GitHub issue if prompt contains #123 format
ISSUE_NUM=$(echo "$DMUX_PROMPT" | grep -oP '#\K\d+' | head -1 || true)
if [ -n "$ISSUE_NUM" ] && command -v gh &> /dev/null; then
  gh issue close "$ISSUE_NUM" \
    -c "Resolved in $DMUX_SLUG, merged to $DMUX_TARGET_BRANCH" \
    2>/dev/null || true
fi
